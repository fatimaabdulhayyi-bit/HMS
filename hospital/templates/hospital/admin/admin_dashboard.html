{% extends 'hospital/admin/base_admin.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}

<div class="container-fluid">

  <!-- DASHBOARD CARDS -->
  <div class="row g-4 px-4 py-4">

    <!-- Doctors -->
    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
      <a href="{% url 'doctors' %}" class="dashboard-card">
        <div class="card-icon">
          <i class="fa fa-user-md"></i>
        </div>
        <div class="card-content">
          <h3>Doctors</h3>
          <p>0</p>
        </div>
      </a>
    </div>

    <!-- Patients -->
    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
      <a href="{% url 'patients' %}" class="dashboard-card">
        <div class="card-icon">
          <i class="fa fa-users"></i>
        </div>
        <div class="card-content">
          <h3>Patients</h3>
          <p>0</p>
        </div>
      </a>
    </div>

    <!-- IPD -->
   <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
      <a href="{% url 'IPD' %}" class="dashboard-card">
        <div class="card-icon">
          <i class="fa fa-bed me-2"></i>
        </div>
        <div class="card-content">
          <h3>In-Patients</h3>
          <p>0</p>
        </div>
      </a>
    </div>

    <!-- Appointments -->
    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
      <a href="{% url 'manage_appointments' %}" class="dashboard-card">
        <div class="card-icon">
          <i class="fa fa-calendar-check"></i>
        </div>
        <div class="card-content">
          <h3>Appointments</h3>
          <p>0</p>
        </div>
      </a>
    </div>

    <!-- Departments -->
    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
      <a href="{% url 'department' %}" class="dashboard-card">
        <div class="card-icon">
          <i class="fa fa-check-circle"></i>
        </div>
        <div class="card-content">
          <h3>Departments</h3>
          <p>0</p>
        </div>
      </a>
    </div>

  </div>

  <!-- LIST SECTION -->
  <div class="row g-4 px-4 pb-4">

    <!-- DOCTORS TABLE -->
    <div class="col-lg-6">
      <div class="list-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Doctors</h3>
          <a href="{% url 'doctors' %}" class="btn-view">View All</a>
        </div>

        <div class="table-responsive">
          <table class="table  table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% if pending_doctors %}
                {% for doctor in pending_doctors %}
                <tr>
                  <td>{{ doctor.full_name }}</td>
                  <td class="d-flex gap-2">
                    <form method="post" action="{% url 'approve_doctor' doctor.id %}">
                      {% csrf_token %}
                      <button class="btn-accept">Accept</button>
                    </form>
                    <form method="post" action="{% url 'reject_doctor' doctor.id %}">
                      {% csrf_token %}
                      <button class="btn-reject">Reject</button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="2" class="text-muted">No pending requests</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- APPOINTMENTS TABLE -->
    <div class="col-lg-6">
      <div class="list-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>Appointments</h3>
          <a href="{% url 'manage_appointments' %}" class="btn-view">View All</a>
        </div>

        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Patient</th>
                <th>Date</th>
                <th>Time</th>
                <th>Doctor</th>
              </tr>
            </thead>
            <tbody>
              {% if ongoing_appointments %}
                {% for appointment in ongoing_appointments %}
                <tr>
                  <td>{{ appointment.patient_name }}</td>
                  <td>{{ appointment.date }}</td>
                  <td>{{ appointment.time }}</td>
                  <td>{{ appointment.doctor }}</td>
                </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="4" class="text-muted">No ongoing appointments</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>


  </div>
  <!-- ================= PENDING BILLING ================= -->
<div class="row g-4 px-4 pb-4">

  <div class="col-lg-12">
    <div class="list-card">

      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Pending Bills</h3>
        <a href="{% url 'bill_list' %}" class="btn-view">
          View Generated Bills
        </a>
      </div>

      <div class="table-responsive">
        <table class="table table-hover align-middle">

          <thead>
            <tr>
              <th>Patient</th>
              <th>Type</th>
              <th>Reference</th>
              <th>Date</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>

          <tbody>

            <!-- ================= OPD PENDING ================= -->
            {% for appt in pending_opd_bills %}
            <tr>
              <td>{{ appt.patient.full_name }}</td>

              <td>
                <span class="badge bg-info">Out-Patient</span>
              </td>

              <td>
                Appointment #{{ appt.token }}
              </td>

              <td>
                {{ appt.date|date:"d M Y" }}
              </td>

              <td class="text-center">
                <a href="{% url 'generate_bills' appt.id %}"
                   class="btn btn-success btn-sm">
                  Generate Bill
                </a>
              </td>
            </tr>
            {% endfor %}

            <!-- ================= IPD PENDING ================= -->
            {% for ipd in pending_ipd_bills %}
            <tr>
              <td>{{ ipd.patient.full_name }}</td>

              <td>
                <span class="badge bg-secondary">In-Patient</span>
              </td>

              <td>
                IPD Admission #{{ ipd.id }}
              </td>

              <td>
                {{ ipd.admission_date|date:"d M Y" }}
              </td>

              <td class="text-center">
                <a href="{% url 'generate_bills' ipd.id %}"
                   class="btn btn-success btn-sm">
                  Generate Bill
                </a>
              </td>
            </tr>
            {% endfor %}

            <!-- ================= EMPTY STATE ================= -->
            {% if not pending_opd_bills and not pending_ipd_bills %}
            <tr>
              <td colspan="5" class="text-center text-muted">
                No pending bills ðŸŽ‰
              </td>
            </tr>
            {% endif %}

          </tbody>

        </table>
      </div>

    </div>
  </div>

</div>


</div>
{% endblock %}
